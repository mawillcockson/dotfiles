{{- /* chezmoi:modify-template */ -}}
{{- /* https://www.chezmoi.io/user-guide/manage-different-types-of-file/#manage-part-but-not-all-of-a-file */ -}}
{{- $current := .chezmoi.stdin -}}
{{- $preGuardComment := "# chezmoi-managed portion (.pre-bashrc)" -}}
{{- $mainGuardComment := "# chezmoi-managed portion (.bashrc)" -}}
{{- $postGuardComment := "# chezmoi-managed portion (.post-bashrc)" -}}
{{- $preManaged := includeTemplate ".pre-bashrc" . | trim -}}
{{- $mainManaged := includeTemplate ".bashrc" . | trim -}}
{{- $postManaged := includeTemplate ".post-bashrc" . | trim -}}
{{- $prePattern := list "(?s)" (regexQuoteMeta $preGuardComment) ".*" (regexQuoteMeta $preGuardComment) | join "" -}}
{{- $mainPattern := list "(?s)" (regexQuoteMeta $mainGuardComment) ".*" (regexQuoteMeta $mainGuardComment) | join "" -}}
{{- $postPattern := list "(?s)" (regexQuoteMeta $postGuardComment) ".*" (regexQuoteMeta $postGuardComment) | join "" -}}
{{- $updatedPreChunk := list $preGuardComment $preManaged $preGuardComment | join "\n" -}}
{{- $updatedMainChunk := list $mainGuardComment $mainManaged $mainGuardComment | join "\n" -}}
{{- $updatedPostChunk := list $postGuardComment $postManaged $postGuardComment | join "\n" -}}
{{- $result := list -}}
{{- if $current | contains $preGuardComment | and (not ($current | mustRegexMatch $prePattern)) -}}
{{- /* this error is likely from a single guard comment line being deleted */ -}}
{{- call (regexMatch $prePattern $current) -}}
{{- /* the above line is intentionally incorrect */ -}}
{{- else -}}
{{- $result = append $result $updatedPreChunk -}}
{{- end -}}
{{- if $current | contains $mainGuardComment | and (not ($current | mustRegexMatch $mainPattern)) -}}
{{- /* this error is likely from a single guard comment line being deleted */ -}}
{{- call (regexMatch $mainPattern $current) -}}
{{- /* the above line is intentionally incorrect */ -}}
{{- else if $current | mustRegexMatch $mainPattern -}}
{{- $mainOnly := mustRegexReplaceAllLiteral $prePattern $current "" -}}
{{- $mainOnly = mustRegexReplaceAllLiteral $postPattern $mainOnly "" -}}
{{- $result = mustRegexReplaceAllLiteral $mainPattern $mainOnly $updatedMainChunk | trim | append $result -}}
{{- else -}}
{{- $noPre := mustRegexReplaceAllLiteral $prePattern $current "" -}}
{{- $result = list $noPre $updatedMainChunk | join "\n" | trim | append $result -}}
{{- end -}}
{{- if $current | contains $postGuardComment | and (not ($current | mustRegexMatch $postPattern)) -}}
{{- /* this error is likely from a single guard comment line being deleted */ -}}
{{- call (regexMatch $postPattern $current) -}}
{{- /* the above line is intentionally incorrect */ -}}
{{- else -}}
{{- $result = append $result $updatedPostChunk -}}
{{- end -}}
{{- $result | join "\n" -}}
