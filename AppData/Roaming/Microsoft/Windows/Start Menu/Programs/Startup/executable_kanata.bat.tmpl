{{- $default_config := joinPath .chezmoi.config.env.XDG_CONFIG_HOME "kanata" "kanata.kbd" -}}
{{- $extra_config := joinPath (env "APPDATA" | default (joinPath .chezmoi.destDir "AppData" "Roaming")) "kanata" "kanata.kbd" -}}
cmd /q /u /d /e:off /f:off /v:off /c start "" /min /d "
{{- if stat $default_config -}}
    {{- osDir $default_config -}}
{{- else -}}
    {{- osDir $extra_config -}}
{{- end -}}" "{{-
range (
    env "PATH" |
    splitList .chezmoi.pathListSeparator |
    concat (
        list (joinPath .chezmoi.destDir ".local" "bin")
             (joinPath .chezmoi.destDir "apps" "eget-bin")
    ) |
    uniq
) -}}
    {{- $matches := glob (joinPath . "kanata*") -}}
    {{- if $matches -}}
        {{- range $matches -}}
            {{- . | replace "/" "\\" -}}
            {{- break -}}
        {{- end -}}
    {{- end -}}
{{- end -}}"
exit
